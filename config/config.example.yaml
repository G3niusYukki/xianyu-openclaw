# 闲鱼自动化工具配置文件
# Xianyu Automation Tool Configuration

# 应用配置
app:
  name: "xianyu-openclaw"
  version: "4.5.0"
  debug: false
  log_level: "INFO"
  data_dir: "data"
  logs_dir: "logs"
  runtime: "auto" # auto | lite | pro

# 浏览器自动化配置 (通过 OpenClaw Gateway Browser API)
openclaw:
  timeout: 30
  retry_times: 3

# AI服务配置
ai:
  provider: "deepseek"  # 支持: openai, deepseek, aliyun_bailian, volcengine_ark, minimax, zhipu
  api_key: "${AI_API_KEY}"
  base_url: "${AI_BASE_URL}"
  model: "${AI_MODEL}"
  temperature: 0.7
  max_tokens: 1000
  fallback_enabled: true
  fallback_model: "gpt-3.5-turbo"
  usage_mode: "minimal" # always | auto | minimal
  max_calls_per_run: 20
  cache_ttl_seconds: 900
  cache_max_entries: 200
  task_switches:
    title: false
    description: false
    optimize_title: false
    seo_keywords: false

# 数据库配置
database:
  type: "sqlite"
  path: "data/agent.db"
  max_connections: 5
  timeout: 30

# 多账号配置
accounts:
  - id: "account_1"
    name: "主账号"
    cookie: "${XIANYU_COOKIE_1}"
    priority: 1
    enabled: true

# 默认账号设置
default_account: "account_1"

# 定时任务配置
scheduler:
  enabled: false
  timezone: "Asia/Shanghai"
  polish:
    enabled: true
    cron: "0 9 * * *"
  metrics:
    enabled: true
    cron: "0 */4 * * *"

# 媒体处理配置
media:
  max_image_size: 5242880  # 最大5MB
  supported_formats: ["jpg", "jpeg", "png", "webp"]
  output_format: "jpeg"
  output_quality: 85
  max_width: 1500
  max_height: 1500
  watermark:
    enabled: false
    text: "闲鱼助手"
    position: "bottom-right"
    font_size: 24
    color: "#FFFFFF"

# 内容生成配置
content:
  title:
    max_length: 25
    min_length: 10
    keywords_enabled: true
  description:
    max_length: 500
    min_length: 50
    structure_enabled: true
  templates:
    enabled: true
    path: "config/templates"

# 浏览器配置
browser:
  headless: true
  user_agent: ""
  viewport:
    width: 1280
    height: 800
  delay:
    min: 1
    max: 3
  upload_timeout: 60

# 消息自动回复配置
messages:
  enabled: false
  transport: "ws" # dom | ws | auto
  ws:
    base_url: "wss://wss-goofish.dingtalk.com/"
    heartbeat_interval_seconds: 15
    heartbeat_timeout_seconds: 5
    reconnect_delay_seconds: 3.0
    message_expire_ms: 300000
    max_queue_size: 200
    queue_wait_seconds: 0.3
    token_refresh_interval_seconds: 3600
    token_retry_seconds: 300
  max_replies_per_run: 10
  fast_reply_enabled: true
  reply_target_seconds: 3.0
  reuse_message_page: true
  first_reply_delay_seconds: [0.25, 0.9]
  inter_reply_delay_seconds: [0.4, 1.2]
  send_confirm_delay_seconds: [0.15, 0.35]
  reply_prefix: ""
  default_reply: "您好，宝贝在的，感兴趣可以直接拍下。"
  virtual_default_reply: "在的，这是虚拟商品，拍下后会尽快在聊天内给你处理结果。"
  quote_intent_keywords: ["报价", "多少钱", "价格", "运费", "邮费", "快递费", "寄到", "发到", "送到", "怎么寄"]
  standard_format_trigger_keywords: ["你好", "您好", "在吗", "在不", "hi", "hello", "哈喽", "有人吗"]
  quote_missing_template: "咨询格式：寄件城市～收件城市～重量（多少kg）"
  strict_format_reply_enabled: true
  quote_failed_template: "报价服务暂时繁忙，我先帮您转人工确认，确保价格准确。"
  virtual_product_keywords: ["虚拟", "卡密", "激活码", "兑换码", "CDK", "代下单", "代充", "代订"]
  intent_rules:
    - name: "card_code_delivery"
      priority: 10
      keywords: ["卡密", "兑换码", "激活码", "CDK", "授权码", "序列号"]
      reply: "这是虚拟商品，付款后会通过平台聊天发卡密/兑换信息，请按商品说明使用。"
    - name: "online_fulfillment"
      priority: 20
      keywords: ["代下单", "代拍", "代充", "代购", "代订"]
      reply: "支持代下单服务，请把具体需求、数量和时效发我，我确认后马上安排。"
    - name: "delivery_eta"
      priority: 30
      keywords: ["多久发", "发货时间", "什么时候发", "多久到账"]
      patterns: ["\\d+\\s*分钟", "\\d+\\s*小时"]
      reply: "虚拟商品通常付款后几分钟内处理，高峰期会稍有延迟，我会尽快给你。"
  keyword_replies:
    还在: "在的，商品还在，直接拍就可以。"
    包邮: "默认不包邮，具体看地区可以商量。"
    最低: "价格已经尽量实在了，诚心要的话可以小刀。"
  workflow:
    db_path: "data/workflow.db"
    poll_interval_seconds: 1.0
    scan_limit: 20
    claim_limit: 10
    lease_seconds: 60
    max_attempts: 3
    backoff_seconds: 2
    sla:
      window_minutes: 60
      min_samples: 5
      reply_p95_threshold_ms: 3000
      quote_success_rate_threshold: 0.98
    notifications:
      feishu:
        enabled: false
        webhook: "${FEISHU_BOT_WEBHOOK}"
        notify_on_start: false
        notify_on_alert: true
        notify_recovery: true
        heartbeat_minutes: 30
        bot_name: "闲鱼自动化助手"

# 自动报价配置
quote:
  enabled: true
  mode: "cost_table_plus_markup" # rule_only | remote_only | remote_then_rule | cost_table_plus_markup | api_cost_plus_markup
  ttl_seconds: 90
  max_stale_seconds: 300
  timeout_ms: 3000
  retry_times: 2
  circuit_fail_threshold: 3
  circuit_open_seconds: 30
  safety_margin: 0.03
  validity_minutes: 30
  analytics_log_enabled: true
  pricing_profile: "normal" # normal | member
  cost_table_dir: "data/quote_costs"
  cost_table_patterns: ["*.xlsx", "*.csv"]
  cost_api_url: ""
  cost_api_key_env: "QUOTE_COST_API_KEY"
  api_fallback_to_table_parallel: true
  api_prefer_max_wait_seconds: 1.2
  volume_divisor_default: 6000
  markup_rules:
    default:
      normal_first_add: 0.50
      member_first_add: 0.25
      normal_extra_add: 0.50
      member_extra_add: 0.30
  providers:
    remote:
      enabled: false
      simulated_latency_ms: 120
      failure_rate: 0.0

# 合规规则文件（详细规则见 config/rules.yaml）
rules:
  path: "config/rules.yaml"
