# 闲鱼自动化工具配置文件
# Xianyu Automation Tool Configuration

# 应用配置
app:
  name: "xianyu-openclaw"
  version: "4.1.0"
  debug: false
  log_level: "INFO"
  data_dir: "data"
  logs_dir: "logs"

# 浏览器自动化配置 (通过 OpenClaw Gateway Browser API)
openclaw:
  timeout: 30
  retry_times: 3

# AI服务配置
ai:
  provider: "deepseek"  # 支持: openai, deepseek
  api_key: "${OPENAI_API_KEY}"
  base_url: "https://api.deepseek.com/v1"
  model: "deepseek-chat"
  temperature: 0.7
  max_tokens: 1000
  fallback_enabled: true
  fallback_model: "gpt-3.5-turbo"
  # 成本优先：仅必要环节接入 AI
  usage_mode: "minimal"   # always | auto | minimal
  max_calls_per_run: 20
  cache_enabled: true
  cache_path: "data/ai_response_cache.json"
  cache_ttl_seconds: 86400
  cache_max_entries: 2000
  task_ai_enabled:
    title: false
    description: false
    optimize_title: true
    seo_keywords: true

# 数据库配置
database:
  type: "sqlite"
  path: "data/agent.db"
  max_connections: 5
  timeout: 30

# 多账号配置
accounts:
  - id: "account_1"
    name: "主账号"
    cookie: "${XIANYU_COOKIE_1}"
    priority: 1
    enabled: true

# 默认账号设置
default_account: "account_1"

# 定时任务配置
scheduler:
  enabled: false
  timezone: "Asia/Shanghai"
  polish:
    enabled: true
    cron: "0 9 * * *"
  metrics:
    enabled: true
    cron: "0 */4 * * *"

# 媒体处理配置
media:
  max_image_size: 5242880  # 最大5MB
  supported_formats: ["jpg", "jpeg", "png", "webp"]
  output_format: "jpeg"
  output_quality: 85
  max_width: 1500
  max_height: 1500
  watermark:
    enabled: false
    text: "闲鱼助手"
    position: "bottom-right"
    font_size: 24
    color: "#FFFFFF"

# 内容生成配置
content:
  title:
    max_length: 25
    min_length: 10
    keywords_enabled: true
  description:
    max_length: 500
    min_length: 50
    structure_enabled: true
  templates:
    enabled: true
    path: "config/templates"

# 浏览器配置
browser:
  headless: true
  user_agent: ""
  viewport:
    width: 1280
    height: 800
  delay:
    min: 1
    max: 3
  upload_timeout: 60

# 消息自动回复配置
messages:
  enabled: false
  max_replies_per_run: 10
  fast_first_reply_enabled: true
  first_reply_target_seconds: 3.0
  reuse_message_page: true
  first_reply_delay_seconds: [0.25, 0.8]
  inter_reply_delay_seconds: [0.4, 1.2]
  send_confirm_delay_seconds: [0.15, 0.35]
  followup_quote_enabled: true
  followup_quote_delay_seconds: [0.6, 1.5]
  # 已读未回合规跟进（默认关闭，建议先 dry-run 观察）
  read_no_reply_followup_enabled: false
  read_no_reply_limit_per_run: 20
  read_no_reply_min_elapsed_seconds: 300
  read_no_reply_min_interval_seconds: 1800
  read_no_reply_max_per_session: 1
  read_no_reply_templates:
    - "看到你已读啦，我先把这个方案给你留着。需要我按你的重量和地区再精确算一次吗？"
    - "如果你还在比较寄件方案，我可以按你的预算再给一个更省的选项，需要的话直接回我“继续报价”就行。"
  read_no_reply_stop_keywords: ["不用", "不需要", "先不", "别发了", "勿扰", "拉黑", "举报"]
  followup_state_path: "data/messages_followup_state.json"
  followup_state_max_sessions: 5000
  # 会话状态机（NEW/REPLIED/QUOTED/FOLLOWED/ORDERED/CLOSED）
  workflow_state_enabled: true
  workflow_state_path: "data/message_workflow_state.json"
  workflow_state_max_sessions: 5000
  # 常驻 worker（7x24 轮询执行 auto-workflow）
  worker_enabled: false
  worker_interval_seconds: 15
  worker_jitter_seconds: 1.5
  worker_backoff_seconds: 5
  worker_max_backoff_seconds: 120
  worker_state_path: "data/workflow_worker_state.json"
  # SLA 监控与告警
  worker_sla_enabled: true
  worker_sla_path: "data/workflow_sla_metrics.json"
  worker_sla_window_size: 500
  worker_alert_min_samples: 10
  worker_alert_failure_rate_threshold: 0.2
  worker_alert_first_reply_within_target_ratio_threshold: 0.7
  worker_alert_cycle_p95_seconds: 20
  reply_prefix: ""
  default_reply: "您好，宝贝在的，感兴趣可以直接拍下。"
  virtual_default_reply: "在的，这是虚拟商品，拍下后会尽快在聊天内给你处理结果。"
  virtual_product_keywords: ["虚拟", "卡密", "激活码", "兑换码", "CDK", "代下单", "代充", "代订"]
  intent_rules:
    - name: "card_code_delivery"
      priority: 10
      keywords: ["卡密", "兑换码", "激活码", "CDK", "授权码", "序列号"]
      reply: "这是虚拟商品，付款后会通过平台聊天发卡密/兑换信息，请按商品说明使用。"
    - name: "online_fulfillment"
      priority: 20
      keywords: ["代下单", "代拍", "代充", "代购", "代订"]
      reply: "支持代下单服务，请把具体需求、数量和时效发我，我确认后马上安排。"
    - name: "delivery_eta"
      priority: 30
      keywords: ["多久发", "发货时间", "什么时候发", "多久到账"]
      patterns: ["\\d+\\s*分钟", "\\d+\\s*小时"]
      reply: "虚拟商品通常付款后几分钟内处理，高峰期会稍有延迟，我会尽快给你。"
  keyword_replies:
    还在: "在的，商品还在，直接拍就可以。"
    包邮: "默认不包邮，具体看地区可以商量。"
    最低: "价格已经尽量实在了，诚心要的话可以小刀。"

# 自动报价配置（快递服务）
quote:
  enabled: true
  mode: "cost_table_plus_markup"  # rule_only | remote_then_rule | cost_table_plus_markup | api_cost_plus_markup
  origin_city: "安徽"
  pricing_profile: "normal"  # normal | member
  preferred_couriers: ["圆通", "韵达", "中通", "申通"]
  cost_table_dir: "data/quote_costs"
  cost_table_patterns: ["*.xlsx", "*.csv"]
  # 成本价加价规则（首重/续重）
  markup_rules:
    default:
      normal_first_add: 0.50
      member_first_add: 0.25
      normal_extra_add: 0.50
      member_extra_add: 0.30
    圆通:
      normal_first_add: 0.56
      member_first_add: 0.30
      normal_extra_add: 0.50
      member_extra_add: 0.30
    韵达:
      normal_first_add: 0.87
      member_first_add: 0.57
      normal_extra_add: 0.40
      member_extra_add: 0.30
    中通:
      normal_first_add: 0.60
      member_first_add: 0.30
      normal_extra_add: 0.60
      member_extra_add: 0.40
    申通:
      normal_first_add: 0.50
      member_first_add: 0.25
      normal_extra_add: 0.50
      member_extra_add: 0.30
    德邦:
      normal_first_add: 0.70
      member_first_add: 0.40
      normal_extra_add: 0.50
      member_extra_add: 0.30
    顺丰:
      normal_first_add: 0.20
      member_first_add: 0.20
      normal_extra_add: 0.30
      member_extra_add: 0.30
    京东:
      normal_first_add: 0.70
      member_first_add: 0.30
      normal_extra_add: 0.50
      member_extra_add: 0.30
    邮政:
      normal_first_add: 0.50
      member_first_add: 0.25
      normal_extra_add: 0.50
      member_extra_add: 0.40
  # mode = api_cost_plus_markup 时生效（接口返回成本价，再套加价规则）
  cost_api_url: ""
  cost_api_key: "${QUOTE_COST_API_KEY}"
  cost_api_timeout_seconds: 3
  cost_api_headers: {}
  currency: "CNY"
  first_weight_kg: 1.0
  first_price: 8.0
  extra_per_kg: 2.5
  service_fee: 1.0
  urgency_fee: 4.0
  inter_city_extra: 2.0
  remote_extra: 6.0
  remote_keywords: ["新疆", "西藏", "青海", "甘肃", "内蒙古", "海南"]
  eta_same_city_minutes: 90
  eta_inter_city_minutes: 360
  valid_minutes: 15
  # mode = remote_then_rule 时生效（直接使用接口返回的最终售价）
  remote_api_url: ""
  remote_api_key: "${QUOTE_API_KEY}"
  timeout_seconds: 3

# 合规规则文件（详细规则见 config/rules.yaml）
rules:
  path: "config/rules.yaml"
