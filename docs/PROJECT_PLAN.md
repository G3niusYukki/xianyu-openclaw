# 闲鱼自动化工具项目计划书

## 一、项目概述

### 1.1 项目背景

闲鱼作为国内最大的二手交易平台，拥有庞大的用户群体和活跃的交易市场。对于个人卖家和小型商家而言，闲鱼店铺的日常运营涉及大量重复性工作，包括商品上架、内容编辑、价格调整、信息擦亮等。这些工作虽然操作简单，但耗时耗力且容易遗漏，严重制约了店铺的运营效率和发展规模。

传统的人工运营方式存在诸多痛点。首先，商品发布流程繁琐，需要手动上传图片、填写标题、编辑描述、设置价格，每次发布商品平均需要10至15分钟。其次，店铺维护工作重复，如每日擦亮商品、调整价格、回复咨询等，需要持续投入时间和精力。再者，数据记录困难，商品浏览量、想要数、成交量等关键指标难以系统化追踪和分析。最后，多账号管理复杂，许多卖家同时运营多个闲鱼账号，人工切换和统一管理极为不便。

基于OpenClaw框架开发的闲鱼自动化工具，旨在通过AI技术和浏览器自动化手段，实现闲鱼店铺运营的全面智能化。OpenClaw作为一款强大的个人AI助手框架，提供了完善的工具系统、技能体系和浏览器控制能力，为本项目的实施奠定了坚实的技术基础。

### 1.2 项目目标

本项目的核心目标是构建一个功能完善、运行稳定、安全可靠的闲鱼自动化运营工具。具体而言，项目需要实现以下主要目标：

在商品发布方面，系统应支持自动化生成高质量的商品标题和描述文案，智能处理商品图片（包括尺寸调整、批量压缩、水印添加等），一键完成商品上架全流程，并支持批量发布多个商品。

在店铺运营方面，系统应实现自动化擦亮功能，支持定时任务和批量操作，自动化价格调整和促销策略执行，以及多账号统一管理和切换。

在数据分析方面，系统应自动记录商品各项数据指标（浏览量、想要数、咨询量、成交量等），生成运营报表和分析图表，支持数据导出和趋势预测。

在智能化方面，系统应集成大语言模型能力，实现智能文案生成和优化，提供个性化推荐建议，持续学习优化运营策略。

### 1.3 项目范围

本项目基于OpenClaw框架的技能系统和工具系统进行开发，主要包含以下内容：

项目涵盖的核心模块包括：商品发布模块（自动化上架、内容生成、图片处理）、店铺运营模块（擦亮、下架、调价）、数据记录模块（日志存储、指标追踪、报表生成）、多账号管理模块（账号切换、统一监控）以及智能助手模块（文案生成、对话交互）。

项目不涉及的内容包括：不涉及闲鱼账号的注册和养号功能，不涉及任何形式的刷单和虚假交易行为，不涉及支付和交易环节的自动化操作，不涉及违反闲鱼平台规则的功能开发。

## 二、技术架构设计

### 2.1 整体架构

本项目采用分层架构设计，遵循OpenClaw框架的规范，将系统划分为技能层、服务层和基础设施层三个主要层次。整体架构既保证了各层之间的独立性，又确保了系统的整体协调和高效运行。

技能层（Skills Layer）位于系统最上层，直接面向用户需求。每个技能都是一个独立的功能单元，包含标准的接口规范和描述文档。技能层负责接收用户指令、解析任务需求、调用下层服务，并将执行结果返回给用户。本项目计划开发五个核心技能：xianyu-publish（商品发布技能）、xianyu-manage（店铺管理技能）、xianyu-metrics（数据统计技能）、xianyu-content（内容生成技能）和xianyu-accounts（多账号管理技能）。

服务层（Services Layer）位于架构中间层，负责实现具体的业务逻辑。服务层由多个功能模块组成，每个模块专注于特定的业务领域。模块之间通过标准化的接口进行通信，保持松耦合关系。本项目规划的服务模块包括：listing-service（商品上架服务）、media-service（媒体处理服务）、content-service（内容生成服务）、operations-service（运营操作服务）、analytics-service（数据分析服务）和account-service（账号管理服务）。

基础设施层（Infrastructure Layer）位于系统最底层，提供运行时环境和基础能力支撑。基础设施层主要包括：OpenClaw浏览器控制器（负责与OpenClaw实例的通信和交互）、配置文件管理系统（支持YAML和.env配置格式）、数据库访问层（提供SQLite数据库的操作封装）、日志系统（统一的日志记录和查询接口）以及工具函数库（提供各类通用工具函数）。

### 2.2 技术选型

本项目的技术选型遵循以下原则：优先采用OpenClaw框架原生支持的技术栈，确保兼容性和稳定性；选择成熟稳定的技术方案，降低开发和维护成本；保持技术栈的简洁性，避免过度设计。

编程语言方面，项目采用Python 3.10+作为主要开发语言。Python在AI和数据处理领域具有丰富的生态优势，且与OpenClaw框架的技术栈高度契合。

异步框架方面，项目采用asyncio和async/await异步编程模式。这一选择与OpenClaw框架的异步架构保持一致，能够高效处理浏览器自动化中的IO密集型操作，提升系统整体的并发处理能力。

浏览器自动化方面，项目采用Playwright作为底层浏览器控制库。Playwright提供了现代化的API设计，支持多种浏览器（Chromium、Firefox、WebKit），具备自动等待、网络拦截、页面截图等丰富功能，非常适合复杂的网页自动化场景。

AI集成方面，项目支持对接多种大语言模型，包括OpenAI GPT系列、DeepSeek模型、Claude模型等。通过统一的接口封装，系统可以灵活切换不同的模型提供商，支持模型降级和故障转移。

数据存储方面，项目采用SQLite作为主要数据库。SQLite作为轻量级嵌入式数据库，无需独立的数据库服务进程，部署简单且维护成本低，完全满足单机应用场景的数据存储需求。

配置管理方面，项目采用YAML格式作为主配置文件，辅以.env环境变量文件。YAML格式具有良好的可读性和结构表达能力，.env文件则便于管理敏感配置信息。

### 2.3 模块详细设计

#### 2.3.1 商品发布模块（listing-service）

商品发布模块是系统的核心模块之一，负责实现商品从准备到上架的全流程自动化。模块设计遵循高内聚、低耦合的原则，将发布流程分解为多个可独立调用的服务方法。

模块的核心数据结构包括：Listing（商品信息数据类）用于存储商品标题、描述、价格、分类、图片列表等完整信息；ListingImage（图片数据类）用于管理单张图片的本地路径、处理状态和展示顺序；CategoryInfo（分类信息类）用于缓存闲鱼商品分类数据。

模块提供的主要服务方法包括：prepare_listing()方法用于预处理商品数据，包括校验信息完整性、调用内容生成服务生成标题描述、调用媒体处理服务处理图片等；create_listing()方法负责实际的浏览器自动化操作，包括导航到发布页面、上传图片、填写表单、设置价格、提交发布等；batch_publish()方法支持批量发布多个商品，实现队列式处理和进度追踪；verify_publish_result()方法用于验证发布结果，提取生成的商品链接和ID。

#### 2.3.2 媒体处理模块（media-service）

媒体处理模块负责商品图片的自动化处理，确保图片符合闲鱼平台的规范要求。闲鱼对商品图片有明确的尺寸和格式要求，媒体处理模块通过自动化处理解决这些问题。

模块的核心功能包括：图片尺寸调整功能将原始图片调整为闲鱼要求的规格，保持宽高比并在必要时填充白边，确保图片在平台展示时不变形；图片压缩功能在保证图片质量的前提下减小文件体积，提高上传速度并节省存储空间；水印添加功能支持在图片指定位置添加自定义水印，保护图片版权；批量处理功能支持对多个商品的多张图片进行自动化批量处理，自动维护图片顺序和处理状态。

模块的技术实现基于Pillow（PIL）图像处理库，提供了resize_image_for_xianyu()、compress_image()、add_watermark()、batch_process_images()等核心函数。所有处理函数都支持配置参数自定义，可以根据不同需求灵活调整处理策略。

#### 2.3.3 内容生成模块（content-service）

内容生成模块集成了大语言模型能力，负责智能生成高质量的商品标题和描述文案。模块设计充分考虑了闲鱼平台的内容特点和用户偏好，生成的内容既符合平台规范，又能有效吸引买家。

标题生成功能的特点包括：长度控制在20字以内，简洁有力；融入热搜关键词，提高搜索曝光率；突出商品卖点和性价比；使用吸引眼球的表达方式。系统预设了多种标题模板和关键词库，可以根据商品类别自动匹配最适合的模板和关键词。

描述生成功能的特点包括：篇幅控制在100至200字，详细但不冗长；涵盖商品成色、使用情况、转手原因等买家关心的信息；语气亲切自然，营造真实感；引导买家私聊，促进互动转化。

模块的降级策略设计：当API调用失败或未配置AI服务时，返回预设的默认文案模板；当生成内容不符合规范时，自动进行修正和优化；当所有自动生成方案都不可用时，提示用户手动填写。

#### 2.3.4 运营操作模块（operations-service）

运营操作模块封装了闲鱼店铺的日常运营操作，包括商品擦亮、价格调整、下架处理等。该模块通过浏览器自动化模拟人工操作，实现运营任务的批量执行。

商品擦亮功能是模块的核心功能之一。擦亮操作能够刷新商品信息，提高商品在闲鱼搜索结果中的排名。功能设计包括：自动访问"我的出售"页面，识别所有可擦亮的商品；模拟真实用户行为，在每个操作之间插入随机延迟；支持全量擦亮和按条件筛选擦亮；记录擦亮结果，统计成功和失败数量。

价格调整功能支持批量修改商品价格。功能设计包括：支持按金额调整（直接定价或加减）和按比例调整（折扣或溢价）；支持针对特定商品或分类批量调整；自动记录调价历史，便于追溯和分析。

下架处理功能支持批量下架商品。功能设计包括：支持下架全部商品或按条件筛选；下架前提示确认，防止误操作；支持下架原因标注，便于后续分析。

#### 2.3.5 数据分析模块（analytics-service）

数据分析模块负责数据的收集、存储和分析，为运营决策提供数据支撑。模块采用SQLite数据库存储各类数据，提供了完善的数据管理和查询接口。

数据存储设计包括两个主要数据表：operation_logs表用于记录所有自动化操作的详细信息，包含操作类型、操作详情、操作时间、执行账号、操作结果等字段；product_metrics表用于存储商品的关键指标数据，包含商品ID、标题、浏览量、想要数、咨询量、成交量、记录时间等字段。

数据采集设计包括：自动采集功能在每次执行运营操作后自动记录相关数据；定时采集功能通过定时任务定期采集商品指标数据；手动采集功能支持用户手动触发数据采集，满足即时查询需求。

报表生成设计包括：日报表汇总每日的运营数据，包括发布数量、擦亮次数、浏览增量、成交情况等；周报和月报提供更长时间维度的数据分析和趋势展示；自定义报表支持用户根据需求灵活配置报表内容和格式。

#### 2.3.6 账号管理模块（account-service）

账号管理模块支持多闲鱼账号的统一管理。对于同时运营多个闲鱼账号的卖家，模块提供了便捷的账号切换和数据汇总功能。

账号配置设计采用YAML配置格式，支持配置多个账号的登录凭证（Cookie或Token）。每个账号的配置包含账号标识、登录凭证、优先级设置、启用状态等信息。系统启动时加载所有账号配置，用户可以选择单个账号或全部账号执行操作。

账号切换设计：模块提供了便捷的账号切换接口，支持在运行时动态切换当前操作账号；切换账号时自动完成浏览器登录状态切换；支持按顺序轮询多个账号执行任务，实现负载均衡。

数据隔离设计：每个账号的数据独立存储，通过账号标识进行关联；多账号数据汇总分析时保持数据的完整性和可追溯性；支持按账号维度导出和查看运营数据。

## 三、核心功能规划

### 3.1 商品发布功能

商品发布功能是本项目最核心的功能模块，实现从商品信息准备到最终上架的全流程自动化。整个发布流程分为商品准备、图片处理、内容生成、浏览器自动化和数据记录五个阶段。

在商品准备阶段，用户可以通过多种方式提供商品信息：手动输入商品标题、描述、价格等基本信息；上传Excel/CSV格式的商品数据列表；提供商品链接，自动抓取商品信息；拍照或上传图片，利用AI识别商品属性。系统接收用户输入后，进行数据校验和格式标准化，生成统一的Listing数据对象。

在图片处理阶段，系统自动处理用户提供的商品图片。处理流程包括：图片格式校验，确保图片格式符合闲鱼要求（支持JPG、PNG、WebP等常见格式）；尺寸调整，根据闲云的推荐尺寸进行自适应调整，必要时填充白边保持比例；质量优化，在保证视觉效果的前提下压缩图片体积；水印添加，根据配置在指定位置添加水印；顺序编排，按照用户指定的顺序或默认规则编排图片展示顺序。处理完成的图片保存到指定目录，供后续发布使用。

在内容生成阶段，系统调用大语言模型生成商品文案。标题生成流程：首先分析商品类别和特点，从关键词库中匹配相关热搜词；结合商品属性生成多个候选标题；根据标题质量评估模型筛选最优标题；如AI服务不可用，使用预设模板生成标题。描述生成流程：分析商品详情，提取关键卖点；按照标准文案结构（引入、详情、交易说明）组织内容；生成自然流畅、真实感强的描述文本；确保内容符合闲鱼平台规范。

在浏览器自动化阶段，系统通过OpenClaw控制器执行实际的发布操作。操作流程包括：打开闲鱼卖家中心页面；导航到发布商品页面；上传处理好的商品图片；填写标题、描述、价格等信息；选择商品分类和发布形式；预览确认后提交发布；等待发布结果并提取商品链接。整个流程中，系统会模拟人类操作行为，包括随机延迟、适当的操作节奏等，降低被平台检测的风险。

在数据记录阶段，系统自动记录发布结果和相关数据。记录内容包括：发布时间、发布账号、原始商品信息、处理后的图片路径、生成的标题描述、发布的商品链接、发布状态（成功或失败）。记录的数据存入数据库，供后续查询和分析使用。

### 3.2 智能做图功能

智能做图功能旨在帮助用户快速制作高质量的商品展示图片。功能设计充分考虑了闲鱼卖家的实际需求和使用场景，提供多种图片处理和制作方案。

基础图片处理功能面向已有商品图片的用户，提供标准化的图片处理服务。功能包括：尺寸调整，自动将图片调整为闲鱼推荐尺寸，支持批量处理多张图片；背景处理，支持简单背景替换或纯色背景生成，使商品更加突出；美化滤镜，提供多种预设滤镜一键美化图片，包括明亮、清晰、柔和等风格；瑕疵修复，自动修复商品图片中的小瑕疵，提升图片质量。

智能拼图功能帮助用户制作多图拼接展示。功能包括：模板选择，提供多种预设拼图模板（两图横拼、两图竖拼、三图拼排、九宫格等）；智能排版，根据图片数量自动选择最佳排版方式；边框装饰，支持添加边框、角标、标签等装饰元素；水印添加，在拼图上添加个性化水印，保护图片版权。

文案海报生成功能将商品信息和卖点制作成图文海报。功能包括：模板市场，提供丰富的海报模板，涵盖不同品类和风格；文案匹配，根据商品类别自动推荐匹配的文案模板；元素编辑，支持自定义文字、图标、背景等元素；一键生成，快速生成可用于闲鱼发布的图文内容。

批量处理功能支持对大量图片进行统一处理。功能包括：批量导入，一次性导入多个商品的多张图片；统一处理，应用相同的处理参数到所有图片；进度追踪，实时显示处理进度和状态；异常处理，单独处理失败的图片，不影响整体流程。

### 3.3 文案标题生成功能

文案标题生成功能利用大语言模型和关键词优化技术，帮助用户生成高曝光率的商品标题和吸引人的描述文案。功能设计充分考虑了闲鱼平台的搜索规则和用户行为特点。

智能标题生成功能的核心特性包括：关键词优化，内置闲鱼热搜关键词库，支持根据商品类别自动匹配高热度关键词；标题结构优化，符合闲鱼搜索算法的标题结构，包含品牌、型号、成色、功能等关键信息；长度控制，确保标题长度在最佳范围内（15至25字），兼顾信息量和搜索匹配度；多版本生成，一次生成多个候选标题，供用户选择或测试。

文案生成功能的核心特性包括：品类定制，针对不同商品品类（数码、家居、服饰、美妆等）定制专属文案风格；结构规范，采用标准文案结构（引入、详情、交易说明），确保内容完整；情感共鸣，使用亲切自然的表达方式，营造真实可信的交易氛围；行动引导，文末添加引导性语句，促进买家私聊和成交。

模板管理功能支持用户自定义文案模板。功能包括：模板创建，用户可以创建和保存自己的文案模板；模板市场，系统提供预设的优质模板供用户选用；模板变量，支持在模板中使用变量（如{商品名}、{价格}等），实现批量生成；智能匹配，根据商品属性自动推荐最合适的模板。

AB测试功能支持标题和文案的对比测试。功能包括：多版本生成，为同一商品生成多个标题/文案版本；数据追踪，监控不同版本的曝光和转化数据；效果分析，分析哪个版本效果更好，自动推荐最优方案。

### 3.4 一键擦亮功能

一键擦亮功能是闲鱼店铺运营的常用功能，通过刷新商品信息提高商品在搜索结果中的排名。本功能实现了自动化、定时化的擦亮操作，大幅提升运营效率。

手动擦亮功能支持用户即时触发擦亮操作。操作流程：用户选择要擦亮的商品范围（全选、按分类筛选、按条件筛选）；系统自动访问闲鱼"我的出售"页面；定位所有可擦亮的商品；执行擦亮操作，每个操作间隔随机延迟（1至5秒）；显示擦亮结果，统计成功和失败数量。系统设计了完善的异常处理机制，包括页面加载超时、元素定位失败、网络中断等情况下的重试和报错策略。

定时擦亮功能支持设置自动定时擦亮任务。任务配置包括：执行周期设置，支持每日、每周、自定义周期等模式；执行时间设置，支持指定具体时间或时间范围；商品范围设置，可以配置只擦亮特定条件下的商品；擦亮间隔设置，同一商品两次擦亮之间的最小间隔时间。定时任务采用独立的调度器管理，即使主程序重启也不会影响任务执行。

智能擦亮策略功能提供更精细的擦亮控制。策略包括：优先级设置，根据商品曝光率、浏览量等指标设置擦亮优先级，优先擦亮表现好的商品；频率优化，根据商品上架时间和销售状态动态调整擦亮频率；效果预测，结合历史数据分析擦亮效果，优化擦亮时机；异常监控，监控擦亮成功率，发现异常及时告警。

擦亮记录功能记录每次擦亮的详细数据。记录内容包括：擦亮时间、执行账号、擦亮商品数量、各商品状态、操作耗时。记录数据支持查询、筛选和导出，便于运营分析和问题追溯。

### 3.5 数据记录功能

数据记录功能建立了完整的数据采集、存储和分析体系，为运营决策提供数据支撑。功能设计遵循全面性、准确性和易用性的原则。

自动数据采集功能在多个场景自动采集数据。触发场景包括：商品发布后自动记录发布信息和初始指标；定时任务定期采集商品当前指标（浏览量、想要数等）；用户手动触发可随时采集指定商品的数据；运营操作后自动记录操作日志和结果。采集的数据项包括：商品ID和标题、浏览量、想要数、咨询量、成交量、发布时间、上架天数、当前价格等。

数据存储设计采用结构化的数据库设计。主数据表包括：products表存储商品基础信息，operation_logs表存储操作日志，metrics表存储指标数据，accounts表存储账号信息。数据库支持灵活的查询和统计操作，满足各种数据查询需求。

数据可视化功能将复杂数据转化为直观图表。图表类型包括：折线图展示指标变化趋势，柱状图对比不同时期的数据，饼图展示商品分类占比，热力图展示最佳发布时间和擦亮效果。图表支持交互操作，可以下钻查看详细数据。

数据导出功能支持将数据导出为常用格式。支持的导出格式包括：Excel格式（.xlsx）便于进一步分析和分享，CSV格式（.csv）便于数据导入其他系统，PDF格式（.pdf）便于生成报表和存档。导出内容可以自定义选择字段和时间范围。

### 3.6 多账号管理功能

多账号管理功能专为同时运营多个闲鱼账号的卖家设计，提供统一的账号管理和数据汇总能力。

账号配置功能支持灵活配置多个闲鱼账号。配置信息包括：账号标识（便于识别的名称或编号）、登录凭证（Cookie或Token）、账号优先级（执行任务时的顺序）、启用状态（是否参与自动化任务）。配置文件支持在线编辑和热更新，无需重启程序即可生效。

统一监控功能集中展示所有账号的运营状态。监控内容包括：各账号的商品数量、在线状态、今日数据（浏览、想要、咨询）、待处理事项。监控面板采用仪表盘设计，关键数据一目了然。

数据汇总功能将多个账号的数据聚合分析。汇总维度包括：按账号查看各账号明细数据、汇总展示整体运营数据、跨账号对比分析、账号间数据同步。汇总报表支持多维度钻取，深入分析每个账号的表现。

## 四、开发阶段规划

### 4.1 第一阶段：基础架构搭建

第一阶段的目标是完成项目基础架构的搭建，建立清晰的目录结构、配置文件体系和核心依赖注入机制。这一阶段的工作是后续功能开发的基础，需要确保架构设计的合理性和可扩展性。

主要任务包括：

项目初始化工作需要完成以下内容：创建清晰的项目目录结构，遵循OpenClaw框架规范，设置src、skills、config、data、logs等核心目录；配置Python开发环境，包括虚拟环境搭建、依赖包安装（Playwright、Pillow、PyYAML、python-dotenv等）、代码格式化工具配置（Black、isort）；配置版本控制，初始化Git仓库，添加.gitignore规则，配置代码检查工具（pylint、mypy）；编写项目README和基础文档，说明项目用途、快速开始指南和贡献指南。

配置文件体系需要建立完善的配置管理机制：设计并实现YAML主配置文件结构，涵盖OpenClaw连接配置、AI服务配置、数据库配置、功能开关配置等；设计.env环境变量模板，分离敏感配置；实现配置加载器，支持从默认路径或指定路径加载配置，支持配置热更新；编写配置文件说明文档，详细说明每个配置项的用途和取值范围。

核心依赖注入需要建立解耦的服务调用机制：实现OpenClaw浏览器控制器，提供连接管理、页面操作、元素定位等基础能力；实现服务定位器模式，统一管理和提供各类服务实例；实现依赖注入容器，支持按需注入配置和依赖；建立服务间的通信机制，确保服务可以协调工作。

第一阶段的交付物包括：完整的项目目录结构、可运行的Python虚拟环境、配置文件模板和文档、OpenClaw浏览器控制器核心类、服务注册和依赖管理机制、基础日志系统。

第一阶段预计工作量约为两周，需要完成的代码量约为500至800行，不包括配置文件和文档。

### 4.2 第二阶段：核心模块开发

第二阶段的目标是完成核心业务模块的开发，包括商品发布模块、媒体处理模块和内容生成模块。这些模块是项目功能的基石，需要确保功能完整、运行稳定。

媒体处理模块的开发是第二阶段的重点之一。模块开发包括：设计并实现图片数据类和批量处理函数，搭建图片处理服务的框架；实现图片尺寸调整功能，确保输出符合闲鱼规范；实现图片压缩功能，优化文件体积；实现水印添加功能，支持自定义水印样式；实现批量处理流水线，支持多商品多图片的自动处理；编写单元测试，确保各功能的正确性；编写模块文档，说明功能特性和使用方法。

内容生成模块的开发是第二阶段的另一个重点。模块开发包括：设计并实现AI服务客户端，支持OpenAI和DeepSeek等模型；实现标题生成功能，集成关键词库和模板系统；实现描述生成功能，采用标准文案结构；实现降级策略，确保AI服务不可用时的基本功能；实现Prompt工程，优化生成内容的质量；编写模块文档，说明API接口和使用方法。

第二阶段的交付物包括：商品发布模块（listing-service）完整功能、媒体处理模块（media-service）完整功能、内容生成模块（content-service）完整功能、三个模块的单元测试和集成测试、模块使用文档。

第二阶段预计工作量约为三周，需要完成的代码量约为2000至3000行。

### 4.3 第三阶段：浏览器自动化集成

第三阶段的目标是将OpenClaw浏览器控制能力集成到各业务模块中，实现完整的浏览器自动化功能。这一阶段需要处理大量的页面交互逻辑，确保自动化流程的稳定性和可靠性。

主要任务包括：

浏览器控制器增强需要扩展基础控制器的功能：实现页面导航和等待机制，支持各种页面状态判断；实现元素定位和操作封装，支持CSS选择器和XPath定位；实现表单操作封装，包括文本输入、下拉选择、复选框等；实现文件上传封装，处理input元素和拖拽上传；实现弹窗处理，自动处理各种JavaScript弹窗；实现等待和重试机制，提高操作成功率。

发布流程自动化实现完整的商品发布自动化：实现发布页面导航和元素检测；实现图片上传自动化，支持多图顺序上传；实现标题输入自动化，支持长文本处理；实现描述输入自动化，支持富文本编辑框操作；实现价格和分类设置自动化；实现发布按钮点击和结果验证。

运营操作自动化实现店铺运营常用功能：实现"我的出售"页面访问和数据读取；实现商品列表解析和状态识别；实现擦亮功能自动化；实现价格修改功能自动化；实现下架功能自动化；实现表单提交和结果验证。

异常处理机制确保自动化流程的稳定性：实现页面加载超时处理；实现元素定位失败重试；实现网络中断恢复；实现验证码识别和人工介入；实现操作日志记录和问题追踪。

第三阶段的交付物包括：增强的浏览器控制器（openclaw-controller）、商品发布自动化完整流程、运营操作自动化完整流程、异常处理和重试机制、自动化测试脚本。

第三阶段预计工作量约为三周，需要完成的代码量约为1500至2500行。

### 4.4 第四阶段：技能层封装

第四阶段的目标是将底层的业务模块封装为符合OpenClaw规范的技能（Skills），实现与OpenClaw框架的无缝集成。技能层是用户与系统交互的直接接口，需要确保接口设计的友好性和功能的完整性。

主要任务包括：

xianyu-publish技能封装需要实现：创建skills/xianyu-publish目录结构；实现技能主类（XianyuPublishSkill），继承AgentSkill基类；定义技能元数据（name、description、parameters等）；实现execute方法，接收用户指令并调用底层服务；编写SKILL.md文档，说明技能功能和使用方法；实现技能注册机制，确保OpenClaw可自动加载。

xianyu-manage技能封装需要实现：创建skills/xianyu-manage目录结构；实现技能主类，封装店铺管理操作；定义擦亮、下架、调价等操作的接口；实现参数解析和指令路由；编写技能文档，说明各操作的用法。

xianyu-content技能封装需要实现：创建skills/xianyu-content目录结构；实现技能主类，封装内容生成操作；定义标题生成、描述生成、文案优化的接口；实现模板管理和关键词库集成；编写技能文档。

xianyu-metrics技能封装需要实现：创建skills/xianyu-metrics目录结构；实现技能主类，封装数据查询和报表功能；定义商品数据查询、运营报表生成等接口；实现数据聚合和图表生成；编写技能文档。

技能集成测试需要完成以下工作：测试各技能的基本功能；测试技能间的协同工作；测试与OpenClaw框架的集成；编写集成测试用例和测试报告。

第四阶段的交付物包括：四个核心技能的完整实现（xianyu-publish、xianyu-manage、xianyu-content、xianyu-metrics）、各技能的SKILL.md文档、集成测试用例和测试报告、技能使用指南。

第四阶段预计工作量约为两周，需要完成的代码量约为1000至1500行。

### 4.5 第五阶段：数据分析和报表

第五阶段的目标是完成数据记录和分析功能，建立完善的数据采集、存储和分析体系。这一阶段需要实现数据的自动采集、结构化存储和多维度分析。

主要任务包括：

数据库设计需要建立完善的数据模型：设计并创建products表（商品基础信息）、operation_logs表（操作日志）、metrics表（指标数据）、accounts表（账号信息）等；实现数据库初始化和版本迁移机制；实现数据库连接池和操作封装；编写数据库设计文档和ER图。

数据分析服务需要实现多维度的数据分析能力：实现基础统计功能（计数、求和、平均值等）；实现时间序列分析（趋势、环比、同比等）；实现相关性分析（曝光与转化的关系等）；实现预测分析（销量预测、最佳发布时间等）。

报表生成需要实现多种类型的运营报表：实现日报表生成，包含每日关键指标；实现周报和月报生成，支持多周期对比；实现自定义报表，满足个性化需求；实现报表导出功能（Excel、PDF格式）。

可视化展示需要实现直观的数据展示界面：实现折线图、柱状图、饼图等基础图表；实现数据仪表盘，集中展示关键指标；实现交互式图表，支持数据钻取；编写可视化组件文档和使用指南。

第五阶段的交付物包括：数据库设计和初始化脚本、数据分析服务（analytics-service）、报表生成模块、可视化组件和示例、相关文档和使用指南。

第五阶段预计工作量约为两周，需要完成的代码量约为1000至1500行。

### 4.6 第六阶段：多账号和高级功能

第六阶段的目标是完成多账号管理功能和高级功能特性，提升系统的完整性和实用性。

多账号管理模块需要实现：账号配置管理，支持多账号配置的新增、修改、删除；账号切换机制，实现运行时的账号切换；数据隔离和聚合，确保多账号数据的独立性和整体性；统一监控面板，集中展示所有账号状态。

高级功能需要实现：定时任务系统，支持定时擦亮、定时发布等任务；智能推荐功能，基于数据分析推荐优化策略；异常监控和告警，当操作失败或数据异常时及时通知用户；用户界面优化，提供更友好的交互体验。

系统优化需要完成：性能优化，优化大数据量处理和查询效率；稳定性提升，增强异常处理和恢复机制；安全性加固，保护用户配置和敏感数据；文档完善，更新所有文档和使用指南。

第六阶段的交付物包括：账号管理模块（account-service）、定时任务调度器、高级功能和优化特性、完整的使用文档和API文档。

第六阶段预计工作量约为三周，需要完成的代码量约为1500至2000行。

## 五、接口设计规范

### 5.1 技能接口规范

所有技能必须遵循OpenClaw框架定义的技能接口规范，确保与框架的无缝集成和互操作性。

技能类必须继承AgentSkill基类，并实现以下属性和方法：

```python
from openclaw.agent.skill import AgentSkill
from typing import Any, Dict, List, Optional

class XianyuPublishSkill(AgentSkill):
    # 技能唯一标识符，使用小写字母和连字符
    name = "xianyu-publish"
    
    # 技能功能描述，供用户了解技能用途
    description = "自动化发布闲鱼商品，支持单商品发布和批量发布"
    
    # 技能参数定义，说明技能接受的输入参数
    parameters = {
        "type": "object",
        "properties": {
            "action": {
                "type": "string",
                "description": "操作类型：publish（发布）、batch（批量发布）、verify（验证）"
            },
            "product": {
                "type": "object",
                "description": "商品信息对象，包含标题、描述、价格等"
            },
            "images": {
                "type": "array",
                "description": "商品图片路径列表"
            },
            "account": {
                "type": "string",
                "description": "发布账号标识，不指定则使用默认账号"
            }
        },
        "required": ["action"]
    }
    
    # 技能执行入口
    async def execute(self, **kwargs) -> Dict[str, Any]:
        action = kwargs.get("action", "publish")
        if action == "publish":
            return await self._publish_single(kwargs)
        elif action == "batch":
            return await self._publish_batch(kwargs)
        elif action == "verify":
            return await self._verify_result(kwargs)
        else:
            return {"status": "error", "message": f"Unknown action: {action}"}
```

技能文档（SKILL.md）必须包含以下结构：

```yaml
---
name: xianyu-publish
description: 自动化发布闲鱼商品，支持单商品发布和批量发布
usage: |
  User: "发布这个商品，标题是iPhone 15，价格5000"
  User: "批量发布这10个商品"
  User: "验证刚才发布的商品是否成功"
---

# Xianyu Publish Skill

## 功能说明

本技能用于自动化发布闲鱼商品，支持以下功能：
- 单商品发布
- 批量发布
- 发布结果验证

## 使用方法

### 发布单个商品
提供商品标题、描述、价格和图片，系统自动完成发布流程。

### 批量发布
提供商品列表，系统按顺序批量发布所有商品。

## 参数说明

- `action`: 操作类型
- `product`: 商品信息
- `images`: 图片列表
- `account`: 账号标识
```

### 5.2 服务接口规范

服务层接口设计遵循以下原则：方法职责单一、参数类型明确、返回值标准化、异常处理完善。

```python
from dataclasses import dataclass
from typing import List, Optional, Dict, Any
from enum import Enum

class PublishStatus(Enum):
    SUCCESS = "success"
    FAILED = "failed"
    PENDING = "pending"

@dataclass
class PublishResult:
    status: PublishStatus
    product_id: Optional[str]
    product_url: Optional[str]
    error_message: Optional[str] = None
    timestamp: str = ""

@dataclass
class Listing:
    title: str
    description: str
    price: float
    original_price: Optional[float] = None
    category: str = "General"
    images: List[str] = None
    tags: List[str] = None
    
    def __post_init__(self):
        if self.images is None:
            self.images = []

class ListingService:
    async def create_listing(
        self,
        listing: Listing,
        account_id: Optional[str] = None
    ) -> PublishResult:
        """
        创建并发布单个商品
        
        Args:
            listing: 商品信息对象
            account_id: 账号标识，不指定使用默认账号
            
        Returns:
            PublishResult: 发布结果
        """
        pass
    
    async def batch_publish(
        self,
        listings: List[Listing],
        account_id: Optional[str] = None,
        delay_range: tuple = (3, 8)
    ) -> List[PublishResult]:
        """
        批量发布商品
        
        Args:
            listings: 商品列表
            account_id: 账号标识
            delay_range: 发布间隔时间范围（秒）
            
        Returns:
            List[PublishResult]: 每个商品的发布结果
        """
        pass
```

### 5.3 数据模型规范

数据模型采用Python的dataclass实现，提供清晰的数据结构和类型提示。

```python
from dataclasses import dataclass, field
from typing import Optional, List, Dict, Any
from datetime import datetime

@dataclass
class Product:
    product_id: str
    title: str
    description: str
    price: float
    original_price: Optional[float] = None
    category: str = "General"
    images: List[str] = field(default_factory=list)
    tags: List[str] = field(default_factory=list)
    status: str = "draft"
    account_id: Optional[str] = None
    product_url: Optional[str] = None
    created_at: datetime = field(default_factory=datetime.now)
    updated_at: datetime = field(default_factory=datetime.now)

@dataclass
class OperationLog:
    log_id: str
    operation_type: str
    product_id: Optional[str]
    account_id: Optional[str]
    details: Dict[str, Any]
    status: str
    timestamp: datetime = field(default_factory=datetime.now)
    error_message: Optional[str] = None

@dataclass
class ProductMetrics:
    product_id: str
    views: int = 0
    wants: int = 0
    inquiries: int = 0
    sales: int = 0
    timestamp: datetime = field(default_factory=datetime.now)
```

### 5.4 配置结构规范

YAML配置文件采用结构化的设计，清晰划分不同配置域。

```yaml
# 闲鱼自动化工具配置文件
# config/config.yaml

# 应用配置
app:
  name: "xianyu-openclaw"
  version: "1.0.0"
  debug: false
  log_level: "INFO"
  data_dir: "data"
  logs_dir: "logs"

# OpenClaw连接配置
openclaw:
  host: "localhost"
  port: 9222
  executable_path: ""
  timeout: 30
  retry_times: 3

# AI服务配置
ai:
  provider: "deepseek"  # 支持: openai, deepseek, claude
  api_key: "${OPENAI_API_KEY}"
  base_url: "https://api.deepseek.com/v1"
  model: "deepseek-chat"
  temperature: 0.7
  max_tokens: 1000
  fallback_enabled: true  # 是否启用降级策略
  fallback_api_key: ""
  fallback_model: "gpt-3.5-turbo"

# 数据库配置
database:
  type: "sqlite"
  path: "data/agent.db"
  max_connections: 5
  timeout: 30

# 多账号配置
accounts:
  - id: "account_1"
    name: "主账号"
    cookie: "${XIANYU_COOKIE_1}"
    priority: 1
    enabled: true
  - id: "account_2"
    name: "副账号"
    cookie: "${XIANYU_COOKIE_2}"
    priority: 2
    enabled: true

# 默认账号设置
default_account: "account_1"

# 定时任务配置
scheduler:
  enabled: true
  timezone: "Asia/Shanghai"
  polish:
    enabled: true
    cron: "0 9 * * *"  # 每天上午9点执行
    accounts: ["account_1", "account_2"]
  metrics:
    enabled: true
    cron: "0 */4 * * *"  # 每4小时采集一次
    accounts: ["account_1", "account_2"]

# 媒体处理配置
media:
  max_image_size: 5242880  # 最大5MB
  supported_formats: ["jpg", "jpeg", "png", "webp"]
  output_format: "jpeg"
  output_quality: 85
  max_width: 1500
  max_height: 1500
  watermark:
    enabled: false
    text: "闲鱼助手"
    position: "bottom-right"
    font_size: 24
    color: "#FFFFFF"

# 内容生成配置
content:
  title:
    max_length: 25
    min_length: 10
    keywords_enabled: true
  description:
    max_length: 500
    min_length: 50
    structure_enabled: true
  templates:
    enabled: true
    path: "config/templates"

# 浏览器配置
browser:
  headless: true
  user_agent: ""
  viewport:
    width: 1280
    height: 800
  delay:
    min: 1
    max: 3
  upload_timeout: 60
```

## 六、测试计划

### 6.1 测试策略

本项目采用多层次的测试策略，确保软件质量。测试金字塔从底层的单元测试到中间的集成测试，再到顶层的端到端测试，形成完整的测试覆盖体系。

单元测试覆盖核心业务逻辑和数据处理功能。测试重点包括：媒体处理模块的各图像处理函数、内容生成模块的模板渲染和降级逻辑、数据模型的序列化和反序列化、配置加载和解析逻辑。单元测试要求关键函数的测试覆盖率达到80%以上。

集成测试验证模块间的协作和接口调用。测试重点包括：ListingService与MediaService的协作、ContentService与AI服务的集成、数据库操作的正确性、配置系统的完整加载流程。集成测试采用模拟（Mock）方式隔离外部依赖。

端到端测试验证完整的用户场景。测试重点包括：完整的商品发布流程、擦亮操作的完整流程、数据采集和报表生成流程。端到端测试在测试环境中进行，使用测试账号和模拟数据。

### 6.2 测试环境

测试环境配置与生产环境保持一致，确保测试结果的可靠性。测试环境包括本地测试环境和CI/CD自动化测试环境。

本地测试环境要求：Python 3.10+运行环境、Playwright浏览器（Chromium）、SQLite数据库、mock的AI服务接口。测试数据包括预设的商品信息列表、测试图片素材、历史操作日志。

CI/CD测试环境配置：GitHub Actions自动化测试流程、每次代码提交自动触发测试、测试报告自动生成和归档、测试失败自动告警。

### 6.3 测试用例示例

商品发布模块测试用例：

```python
import pytest
from src.modules.listing.service import ListingService
from src.modules.listing.models import Listing, ListingImage

@pytest.fixture
def sample_listing():
    return Listing(
        title="iPhone 15 Pro Max 256GB 原色钛金属",
        description="全新未拆封苹果官网购买，有发票",
        price=8999.0,
        original_price=9999.0,
        category="数码手机",
        images=["data/raw/img1.jpg", "data/raw/img2.jpg"],
        tags=["苹果", "iPhone", "原色钛金属"]
    )

@pytest.mark.asyncio
async def test_create_listing_success(sample_listing, mock_browser):
    """测试正常发布流程"""
    service = ListingService(controller=mock_browser, config={})
    result = await service.create_listing(sample_listing)
    
    assert result.status == PublishStatus.SUCCESS
    assert result.product_id is not None
    assert result.product_url is not None
    assert result.error_message is None

@pytest.mark.asyncio
async def test_batch_publish_with_delay(sample_listing):
    """测试批量发布延迟"""
    listings = [sample_listing] * 3
    service = ListingService(controller=mock_browser, config={})
    
    import time
    start_time = time.time()
    results = await service.batch_publish(listings, delay_range=(1, 2))
    elapsed_time = time.time() - start_time
    
    assert len(results) == 3
    assert all(r.status == PublishStatus.SUCCESS for r in results)
    assert elapsed_time >= 3  # 至少3秒延迟
```

### 6.4 测试验收标准

功能验收标准：所有需求功能点100%实现并通过测试；核心流程（发布、擦亮、查询）测试通过率100%；边界条件和异常场景测试覆盖率达到70%以上。

性能验收标准：单商品发布操作完成时间不超过30秒；批量发布间隔随机且符合配置范围；数据库查询响应时间不超过1秒（1000条数据内）。

稳定性验收标准：连续运行24小时无崩溃和内存泄漏；网络异常恢复后能继续正常执行；浏览器页面加载超时自动重试。

## 七、风险分析与应对

### 7.1 技术风险

风险一：闲鱼平台页面结构变化导致自动化失效。闲鱼作为商业平台，可能随时调整页面结构、修改元素ID或改变交互逻辑，这将导致现有自动化代码失效。应对策略包括：采用相对稳定的元素定位方式（语义化选择器、文本匹配）；建立页面变更监控系统，实时检测自动化流程是否正常；设计自动化适配机制，快速响应页面变化；预留充足的手动干预选项，确保核心功能可用。

风险二：AI服务不可用导致内容生成功能受损。依赖外部AI服务存在服务不稳定、API变更、额度耗尽等风险。应对策略包括：实现完善的降级策略，AI不可用时使用预设模板；支持多个AI服务提供商，实现自动切换；本地缓存常用内容模板，减少对实时API的依赖；提供用户自定义模板功能，增强可用性。

风险三：浏览器自动化被平台检测和封禁。闲鱼平台有反自动化机制，可能检测到非人类操作并采取措施。应对策略包括：模拟真实用户行为模式，包括随机延迟、操作节奏等；控制操作频率，避免短时间内大量操作；使用真实浏览器特征，减少自动化特征暴露；采用多账号分散操作，降低单一账号的风险暴露。

### 7.2 运营风险

风险一：用户配置错误导致操作异常。用户在使用过程中可能配置错误的Cookie、错误的账号信息或不合理的参数设置。应对策略包括：实现完善的配置校验，在执行前检测配置有效性；提供详细的错误提示，帮助用户定位问题；建立配置向导，引导用户正确配置；记录详细的操作日志，便于问题排查。

风险二：数据丢失或损坏影响使用。数据库损坏、配置文件丢失等情况可能导致用户数据丢失。应对策略包括：实现数据自动备份机制，定期备份数据库和配置；提供数据导出功能，支持用户自行备份；记录操作历史，支持快速恢复；建立数据完整性检测，定期检查数据库状态。

### 7.3 合规风险

风险一：自动化操作违反闲鱼平台规则。闲鱼平台禁止使用自动化工具进行违规操作，包括批量发布、恶意刷量等。应对策略包括：明确项目定位，只实现合法合规的自动化功能；不提供任何刷量、虚假交易相关功能；在文档中明确告知用户合规使用的重要性；设置合理的操作频率限制，避免触发平台风控。

风险二：用户隐私数据泄露风险。系统存储用户的账号Cookie等敏感信息，存在泄露风险。应对策略包括：加密存储敏感配置信息；不记录或传输用户密码等高敏感信息；提供本地部署选项，数据不离开用户设备；明确告知用户数据存储方式和使用范围。

## 八、项目里程碑

### 8.1 里程碑一：基础架构完成

预计完成时间：项目启动后第2周末

交付物：项目目录结构建立、配置文件体系完成、核心依赖注入机制实现、基础日志系统运行正常

验收标准：代码能够正常执行、环境配置正确、各模块可正确加载

### 8.2 里程碑二：核心模块完成

预计完成时间：项目启动后第5周末

交付物：媒体处理模块功能完整、内容生成模块功能完整、单元测试覆盖率达到80%、模块文档编写完成

验收标准：图片处理达到预期效果、AI内容生成质量达标、单元测试全部通过

### 8.3 里程碑三：浏览器自动化完成

预计完成时间：项目启动后第8周末

交付物：商品发布全流程自动化、店铺运营操作自动化、异常处理机制完善、自动化测试覆盖核心流程

验收标准：发布流程稳定运行、操作成功率95%以上、异常情况可正确处理

### 8.4 里程碑四：技能集成完成

预计完成时间：项目启动后第10周末

交付物：四个核心技能完整实现、与OpenClaw框架正确集成、集成测试全部通过、技能文档完善

验收标准：OpenClaw可正确加载技能、技能功能正常响应用户指令

### 8.5 里程碑五：数据分析完成

预计完成时间：项目启动后第12周末

交付物：数据库设计完成并投入使用、数据分析服务运行正常、报表生成功能完整、可视化展示正常

验收标准：数据采集准确无误、报表内容完整正确、查询响应及时

### 8.6 里程碑六：全部功能完成

预计完成时间：项目启动后第15周末

交付物：多账号管理功能完整、定时任务系统运行正常、系统优化完成、全部文档完善

验收标准：所有功能验收通过、性能指标达标、稳定性测试通过

## 九、团队与资源

### 9.1 开发团队配置

本项目建议配置以下角色：

项目负责人一名，负责项目整体规划、进度把控、质量管理和对外协调。需要具备项目管理经验和闲鱼运营背景。

后端开发工程师两至三名，负责核心模块开发、浏览器自动化实现、数据库设计等。需要具备Python开发经验和异步编程能力。

前端开发工程师一名（如需要图形界面），负责Web管理界面开发、数据可视化展示、用户交互优化等。需要具备Web开发经验。

测试工程师一名（可兼职），负责测试用例设计、测试执行、质量把控。需要具备自动化测试经验。

### 9.2 技术资源需求

开发环境：支持Python开发的本地机器，配置要求为8GB以上内存、50GB以上硬盘空间、稳定的网络连接。

测试环境：用于端到端测试的测试账号（建议至少两个）、测试用的商品图片素材、隔离的测试数据环境。

运行环境：用户本地设备（支持Windows、macOS、Linux），需要安装Python运行时、Playwright浏览器、SQLite数据库。

### 9.3 外部服务依赖

AI服务：需要申请OpenAI API Key或DeepSeek API Key用于内容生成服务。

闲鱼账号：需要准备测试账号和生产环境账号，建议使用小号进行初期测试。

云存储（可选）：如需图片CDN加速等扩展功能，可考虑使用云存储服务。

## 十、附录

### 10.1 术语表

OpenClaw：一个开源的个人AI助手框架，提供多渠道通信、工具系统和技能架构。

技能（Skill）：OpenClaw框架中的功能封装单元，每个技能实现特定的功能域。

闲鱼：阿里巴巴旗下的二手交易平台，本项目的主要服务对象。

Listing：商品信息数据结构，包含标题、描述、价格、图片等完整信息。

擦亮：闲鱼平台的商品刷新功能，擦亮后商品可在搜索结果中获得更前的展示位置。

Cookie：闲鱼登录凭证，用于识别用户身份和维持登录状态。

### 10.2 参考资料

OpenClaw官方文档：https://docs.openclaw.ai

闲鱼帮助中心：https://www.goofish.com/help

Playwright官方文档：https://playwright.dev

Python异步编程指南：https://docs.python.org/3/library/asyncio.html

### 10.3 版本历史

| 版本 | 日期 | 修订人 | 修订内容 |
|------|------|--------|----------|
| 1.0.0 | 2026-02-11 | 项目组 | 初版发布 |
