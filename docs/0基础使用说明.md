# 0基础使用说明（从安装到可用）

这份文档面向第一次接触该项目的用户，目标是 20 分钟内跑通：
- 自动回复
- 自动报价（本地成本表或 API 成本价）
- 常驻工作流

## 1. 你需要准备什么

1. 一台电脑（Windows / macOS）
2. 能联网
3. 闲鱼账号 Cookie
4. 一个 AI Key（DeepSeek / OpenAI / Anthropic 任一）

## 2. 最快启动方式

在项目根目录执行：

```bash
python -m src.setup_wizard
```

按提示输入：
1. AI Key
2. 网页登录密码
3. 闲鱼 Cookie
4. 是否初始化报价策略（建议选是）
5. 是否立即启动容器（建议选是）

向导会自动写入 `.env`，并可同时初始化 `config/config.yaml` 的报价配置。

## 3. 报价策略（二选一）

### A. 本地成本表 + 加价规则（推荐先用）

```bash
python -m src.cli quote --action setup --mode cost_table_plus_markup --origin-city 安徽 --cost-table-dir data/quote_costs
```

### B. API 成本价 + 加价规则（接口慢时自动回退本地表）

```bash
python -m src.cli quote --action setup --mode api_cost_plus_markup --origin-city 安徽 --cost-table-dir data/quote_costs --cost-api-url "https://your-cost-api.example.com/v1/quote-cost"
```

## 4. 一键体检和抽样验证

先看配置健康：

```bash
python -m src.cli quote --action doctor
```

抽样模拟买家询价：

```bash
python -m src.cli quote --action preview --message "寄到上海 2kg 圆通 报价"
```

## 5. 启动自动化工作流

先 dry-run 看效果：

```bash
python -m src.cli messages --action auto-workflow --limit 20 --dry-run
```

再启动常驻 worker：

```bash
python -m src.cli messages --action run-worker --limit 20 --interval-seconds 15
```

查看状态：

```bash
python -m src.cli messages --action workflow-status
```

## 6. Windows 用户（bat）

```bat
scripts\windows\setup_windows.bat
scripts\windows\quote_setup_local.bat 安徽 data/quote_costs
scripts\windows\quote_doctor.bat
scripts\windows\quote_preview.bat "寄到上海 2kg 圆通 报价"
scripts\windows\run_worker.bat 20 15
```

## 7. 常见问题

1. `quote doctor` 显示 `file_count=0`
- 把成本表放到 `quote.cost_table_dir` 对应目录，再重试 `quote setup`。

2. 自动回复没发出去
- 先看 `messages --action workflow-status`。
- 检查是否触发外发合规护栏（禁词、频控）。

3. API 模式不稳定
- 保持 `api_fallback_to_table_parallel=true` 和 `api_prefer_max_wait_seconds=1.2`。
- 先保证本地成本表可用。

## 8. 合规建议

1. 只做站内合规交易，不导流站外。
2. 默认开启外发禁词和频控，建议不要关闭。
3. 已读未回跟进先 `dry-run` 观察，再开启实发。
